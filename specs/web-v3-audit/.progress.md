---
spec: web-v3-audit
basePath: specs/web-v3-audit
phase: requirements
task: 0/0
updated: 2026-02-07T05:40:00Z
---

# Progress: web-v3-audit

## Original Goal

Full UI/UX design audit and functional audit of the awesome-site v2 rebuild. Create 3 different design variations:

1. **Variation A** - UI/UX Designer Pro audit-driven design
2. **Variation B** - shadcn/ui blocks + shadcn MCP server driven design
3. **Variation C** - Stitch MCP-generated design

All three variations MUST:
- Have a sidebar navigation
- Be fully responsive
- Maintain 100% feature parity with legacy app
- Follow the same application flow
- Heavy focus on admin panel parity

**Validation Gates** (enforced at every task):
- Screenshots as evidence
- Logs confirming functionality
- Video recordings across all three variations
- Triple-checked physical evidence required before advancing
- NO unit tests - only functional validation through real UI

The gate cannot be passed unless all three verification methods align. If they don't, work continues until they do.

## Completed Tasks

- Research phase completed (2026-02-07)
- [x] 1.1 Install shadcn sidebar component - pending_commit
- [x] 1.2 Create variation CSS token files - pending_commit
- [x] 1.3 Create VariationProvider and VariationScript - pending_commit
- [x] 1.4 Wire VariationProvider into root layout - pending_commit

## Current Task

Awaiting next task

## Next

Task 1.5 Create VariationSwitcher floating UI

## Learnings

- V2 public site uses TOP-BAR navigation (not sidebar). Legacy uses ModernSidebar with category tree. This is the #1 architectural gap for the sidebar requirement.
- V2 admin already HAS a sidebar (admin-sidebar.tsx with 14 nav items). But it uses a custom implementation, not the shadcn Sidebar component (SidebarProvider pattern).
- V2 has 111+ API endpoints across 76 route files. Legacy has ~83. V2 EXCEEDS legacy in API coverage.
- V2 admin has 14 tabs; legacy has 15 tabs. But V2 is MISSING 6 legacy tabs as UI (Export, Database, Validation, Link Health, Audit, Research). V2 has 5 NEW tabs not in legacy. Target = 20 total tabs.
- shadcn MCP has 16 sidebar blocks, 1 dashboard block, and 42 themes (including cyberpunk). The apply_theme tool can apply themes directly.
- Stitch MCP project ID for this site is 14908959412283318545. Supports DESKTOP and MOBILE device types with GEMINI_3_PRO model.
- Puppeteer MCP is available for screenshot capture. Can set width/height per screenshot for responsive validation.
- V2 uses export const GET = withAdmin(...) pattern for route handlers (not export async function GET). This is a custom middleware wrapper.
- The V2 admin uses lazy-loaded tabs (React.lazy + Suspense) for performance. URL-based tab switching via ?tab= query param.
- All V2 admin route APIs exist for the 6 "missing" tabs - only the UI components need to be built.
- The Prisma schema has 30 models (660 lines) - more comprehensive than legacy's 21 Drizzle tables.
- V2 has 0 TypeScript errors and 0 ESLint errors (34 warnings only). Clean compilation baseline.
- (Requirements phase) Admin sidebar is a flat list of 14 Button components in a ScrollArea. No grouping, no collapsible sections. Uses custom AdminNavItem interface, not shadcn Sidebar primitives.
- (Requirements phase) Public top-bar has 4 nav items (Home, Resources, Categories, Journeys). No About link, no category tree, no user section. SearchDialog + ThemeSwitcher + UserMenu in right slot.
- (Requirements phase) MobileNav is a separate component from top-bar. Sidebar-first layout will unify desktop/mobile nav into one Sidebar component with responsive behavior.
- (Requirements phase) Variation switching must be CSS-only (data attributes + custom properties). No React component forks per variation - single component tree with token swaps.
- (Requirements phase) Database admin tab is the only missing tab that also needs a NEW API endpoint (seed). Other 5 missing tabs have APIs already.
- (Requirements phase) 5 unresolved questions identified that need user decision before or during design phase: sidebar coexistence with top-bar, category tree loading strategy, Variation A structural independence, Database seed behavior, Approvals tab treatment.
- (Design phase) shadcn Sidebar component NOT yet installed - `src/components/ui/sidebar.tsx` does not exist. Must run `npx shadcn@latest add sidebar` as first implementation step.
- (Design phase) Root layout.tsx currently renders TopBar + Footer for ALL routes including admin. Admin layout just does `<>{children}</>` passthrough. Sidebar integration requires restructuring: remove TopBar/Footer from root, add SidebarProvider in public route group layout, keep admin layout separate with its own SidebarProvider.
- (Design phase) Variation switching parallels existing theme switching exactly: `data-variation` attribute on `<html>` + CSS custom properties + inline script to prevent FOUC. Theme = colors, Variation = layout/spacing. No conflicts.
- (Design phase) All 6 missing admin tab APIs exist and follow consistent patterns: `withAdmin` middleware, `apiSuccess`/`handleApiError` responses, Zod validation. Only Database seed endpoint needs creation.
- (Design phase) Category tree data available via existing `buildCategoryTreeInclude()` in `category-queries.ts` - returns 3-level tree with resource counts. New public API endpoint needed at `/api/categories/tree`.
- (Design phase) Admin tabs use `React.lazy()` with `.then((m) => ({ default: m.ExportName }))` pattern for named exports. TAB_COMPONENTS record maps string keys to lazy components. Adding 6 tabs = 6 lazy imports + 6 record entries.
- (Design phase) Current admin sidebar is 240px (`w-60`), not 280px. Design specifies 280px to match DESIGN.md sidebar spec. This is a layout-widening change.
- (Design phase) MobileNav and TopBar are separate components but share the same NAV_ITEMS array pattern. Both will be replaced by single AppSidebar with responsive behavior via shadcn SidebarProvider.
- (Implementation) shadcn sidebar installed via `npx shadcn@latest add sidebar`. Created `src/components/ui/sidebar.tsx` (726 lines, 25 exports) and `src/hooks/use-mobile.ts` (not .tsx). Hook file extension is .ts not .tsx as task spec predicted.
- (Design phase) 3 unresolved questions remain: category tree API placement, database seed behavior, approvals tab separation. All have recommendations documented in design.

## Interview Responses

### Requirements Interview (from requirements.md)
- Primary users: Both developers and end users
- Priority tradeoffs: Feature completeness
- Success criteria: All 3 variations with 100% parity - every feature from legacy works in all 3 variations, with screenshot evidence

### Design Interview (from design.md)
- Architecture style: Extend existing architecture
- Technology constraints: No constraints
- Integration approach: Use existing APIs and interfaces

### Tasks Interview (from tasks.md)
- Testing depth: Functional validation first (agent-browse skill for real browser automation), then E2E suite for CI
- Execution priority: Quality first - thorough from start

## Blockers

- None currently

## Next

Tasks generated (48 total across 10 phases). Awaiting approval to proceed to execution.

## Task Planning Learnings

- (Task planning) No `(public)/layout.tsx` exists yet - public routes inherit root layout directly. Phase 2 creates this layout file to wrap public pages with SidebarProvider + AppSidebar.
- (Task planning) nuqs is NOT installed in the project (no imports found). VariationProvider uses native `useSearchParams()` + `useRouter()` for URL state management instead.
- (Task planning) shadcn sidebar component NOT installed yet (`src/components/ui/sidebar.tsx` does not exist). Must be Task 1.1 before any sidebar work.
- (Task planning) No `src/app/api/admin/database/` directory exists. The seed endpoint is the only truly new API route (FR-6 exception). All other 5 missing tab APIs already exist.
- (Task planning) Existing admin tabs follow strict pattern: `"use client"`, named export, `useQuery` with `queryKey` array, `Skeleton` loading, `text-destructive` error. All 6 new tabs must match this pattern exactly.
- (Task planning) Root layout currently renders TopBar + Footer for ALL routes including admin. Admin layout is just `<>{children}</>` passthrough. Removing TopBar from root in Phase 2 affects admin pages too - admin gets its own sidebar via AdminLayoutWrapper.
- (Task planning) The `admin/page.tsx` TAB_COMPONENTS record uses `React.lazy(() => import(...).then((m) => ({ default: m.ExportName })))` pattern for named exports. All 6 new tabs follow this exact pattern.
- (Task planning) Package.json shows Next.js 16.1.6, React 19.2.3, shadcn 3.8.4. Modern versions, all compatible with shadcn sidebar primitives.
- (Task planning) Quality commands confirmed: `npx eslint src/` (lint), `npx tsc --noEmit` (typecheck), `npm run build` (build). No test runner installed.
- (Task planning) Category tree data available via `buildCategoryTreeInclude()` in `category-queries.ts`. Returns 3-level Prisma include with `_count.resources` at each level. New API just wraps this in a GET handler.
- (Task planning) Variation system parallels existing theme system exactly: `data-variation` attribute alongside `data-theme` on `<html>`, CSS custom properties scoped to `[data-variation="x"]`, inline script prevents FOUC. No conflicts because themes control colors, variations control layout/spacing.
- (Task planning) 48 tasks across 10 phases. Quality checkpoints every 2-3 implementation tasks. Screenshot validation in Phase 8 targets 130+ evidence files.
- (Implementation) Created src/styles/ directory and 3 variation CSS files (a, b, c). Imports added to globals.css after the .dark block. Tailwind CSS v4 handles @import of plain CSS files fine - no special config needed.
