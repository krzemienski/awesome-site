---
spec: consolidated-readiness
basePath: ./specs/consolidated-readiness
phase: design
task: 0/0
updated: 2026-02-08T20:30:00Z
---

# Progress: consolidated-readiness

## Original Goal

Audit every single spec that's not 100% complete, consolidate all remaining work into this single spec, and ensure full adherence to validation gates (CONSTITUTION.md + gate-validation-discipline). Functionally test every aspect with three parallel teammates who validate from backend (curl/logs), frontend (Playwright/screenshots), and cross-validation (evidence comparison). All three teammates must confirm completion before any task moves forward. Targets 100+ feature scenarios with zero blockers.

## Completed Tasks

- [x] 1.1 Investigate and fix login flow (US-1)
- [x] 1.2 Fix handleApiError S8 error leakage
- [x] 1.3 Install pino and create structured logger (US-10)
- [x] 1.4 [VERIFY] Quality checkpoint: typecheck + lint after pino integration
- [x] 1.5 Enable noUncheckedIndexedAccess and fix type errors (US-11)

## Current Task

Awaiting next task

## Learnings

- admin-functionality has 67 tasks with 0 checked but significant evidence artifacts already exist in its evidence/ directory (20 admin screenshots, public page screenshots, migration output)
- alpha spec state says 24/24 complete but tasks.md has 0 checked -- likely superseded by later specs
- web-v3-audit-followup state says 8/8 but tasks.md has 0 checked -- evidence shows work was done but tracking not updated
- Login flow has evidence of failure (login-failed.png) -- critical issue to investigate
- 15 of 54 Constitution rules lack any functional validation evidence; 12 more have only partial evidence
- production-audit is the most impactful incomplete spec (26 tasks remaining) covering cookie consent, structured logging, TypeScript strictness, API versioning, CORS, and E2E validation
- admin-e2e-validation already validated export + awesome-lint and has a VALIDATION-REPORT.md -- overlaps with admin-functionality's export validation tasks
- No production-audit evidence directory exists at all
- The awesome-list export was validated in admin-e2e-validation (exported-awesome-list.md exists)
- Total incomplete tasks across all specs: ~116 (67 admin-functionality + 26 production-audit + 13 web-v3-audit + 8 web-v3-audit-followup + 2 possible from alpha)
- Requirements phase: Consolidated 116 tasks into 23 user stories with 130+ acceptance criteria
- Login fix (US-1) is the critical path blocker -- all authenticated validation depends on it
- Deduplication eliminated ~40% of raw tasks: web-v3-audit-followup work already done, admin-e2e-validation export already validated, many production-audit infra items batch well together
- Three-teammate validation gate adds overhead but catches consistency issues (backend says 200 but UI shows error state)
- API versioning (US-12) has architectural ambiguity: rewrites vs directory restructure -- needs design decision before implementation
- 6 unresolved questions identified that may change scope (especially alpha bulk ops and theme variation count)
- Design: handleApiError in api-response.ts leaks error.message for non-AppError 500s -- S8 violation. Fix = return generic "An unexpected error occurred" and log real error via pino.
- Design: Analytics/SpeedInsights are unconditionally rendered in root layout (line 77-78). Cookie consent must wrap these conditionally.
- Design: Admin ban endpoint already has self-protection (ctx.user.id === id check) but role-change endpoint likely lacks it -- verify and fix for S12.
- Design: API versioning via middleware rewrite is ~10 lines of code; zero file restructuring needed. Rewrite preserves query params via nextUrl.clone().
- Design: noUncheckedIndexedAccess will likely produce many type errors given heavy use of array indexing (e.g., homepage reduce, middleware cookie access). Estimate 50-150 errors.
- Design: pino must use serverExternalPackages in next.config to avoid edge runtime bundling issues.
- Design: Existing Playwright specs (admin-tabs.spec.ts) provide good patterns for login + tab navigation. Reuse loginAsAdmin helper.
- Design: Execution phases have strict dependency order -- Phase 1 (login fix) gates Phase 3 (all CRUD validation). Phase 2 (API/security) can run in parallel with Phase 1 for non-auth items.
- Tasks: 62 tasks across 8 phases (Phase 1: Foundation 10, Phase 2: API/Security 6, Phase 3: Data/CRUD 10, Phase 4: Frontend/Playwright 10, Phase 5: Cross-validation 6, Phase 6: Finalization 7, Phase 7: Quality Gates 2, Phase 8: PR Lifecycle 3)
- Tasks: console.error/log/warn count in src/ is very low (only 3 occurrences: 2 in auth.ts, 1 in seed route) -- pino migration is small scope
- Tasks: Role-change endpoint already has self-protection (returns 400, not 403) -- no S12 fix needed, just verification
- Tasks: package.json name is already "awesome-video" -- alpha US-21 AC-21.1 already done
- Tasks: No robots.txt file exists in public/ -- needs creation
- Tasks: ReactQueryDevtools directly imported in query-provider.tsx (not lazy) -- confirmed needs fix
- Tasks: ~80 API route files exist under src/app/api/ -- all routes already use handleApiError pattern, console usage is minimal
- Tasks: Existing Playwright specs (admin-tabs.spec.ts) provide reusable loginAsAdmin(), navigateToTab(), expandAllSidebarGroups() helpers
- Tasks: serverExternalPackages in next.config.ts already has @prisma/client -- just append pino and pino-pretty to array
- Tasks: Phase ordering critical: login (1.1) -> CRUD validation (3.x) -> Playwright (4.x) -> cross-validation (5.x) -> report (6.6)
- pino v10 + pino-pretty v13 installed; server-only not available as npm package so used typeof window guard instead
- pino transport config with pino-pretty for dev uses object spread conditional -- empty object in prod means raw JSON output
- Login root cause: existing admin@test.local user had password hash that didn't match "password123" (created by unknown method). Fix: created admin@example.com via Better Auth sign-up endpoint (proper bcrypt hash), promoted to admin role via SQL, updated .env E2E credentials. Sign-in returns 200 with Set-Cookie: better-auth.session_token.
- Better Auth env: BETTER_AUTH_URL is NOT required server-side (only client uses NEXT_PUBLIC_BETTER_AUTH_URL with fallback to localhost:3000). DATABASE_URL and BETTER_AUTH_SECRET are the only required server env vars.
- S8 fix: Removed conditional error.message exposure in handleApiError non-AppError branch. AppError.message on line 50 is intentionally exposed (user-facing controlled messages). The verify grep catches it but it's safe -- AppError messages are designed to be shown to users.
- noUncheckedIndexedAccess fixes touched ~15 files: awesome-lint.ts, markdown-parser.ts, markdown-formatter.ts, sync-service.ts, link-health-service.ts, search-dialog.tsx, cost-dashboard.tsx, settings-tab.tsx, user-menu.tsx, seed/route.ts. Used optional chaining (?.), nullish coalescing (??), and explicit undefined guards. Zero non-null assertions (!) used.

### Verification: 1.4 [VERIFY] Quality checkpoint: typecheck + lint after pino integration
- Status: PASS (after 2 fixes)
- Commands: tsc --noEmit (exit 0), eslint (exit 0 after fixes)
- Fixes applied:
  - src/components/auth/login-form.tsx line 102: JSX comment text "// Jack into the network." wrapped in braces to fix react/jsx-no-comment-textnodes
  - e2e/admin-functional-validation.ts line 1: Removed unused BrowserContext import to fix @typescript-eslint/no-unused-vars
- Both commands clean after fixes

## Blockers

_No blockers_

## Interview Responses

### Design Interview (from design.md)
- Architecture style: Extend existing architecture -- fix gaps and validate within the current Next.js/Prisma/Better Auth structure
- Technology constraints: No constraints -- use best fit libraries/approaches for each requirement
- Integration approach: API versioning via middleware rewrites (/api/v1/* rewrites to /api/* via Next.js middleware, zero directory changes)

### Tasks Interview (from tasks.md)
- Testing depth: Functional validation only -- NO test frameworks per Constitution V1/V2. Curl, Playwright, screenshots, real DB.
- Execution priority: Quality first -- every story gets full three-teammate validation. No shortcuts even for P2/P3.

## Next

Task 1.6: [VERIFY] Quality checkpoint: full build after TS strictness
