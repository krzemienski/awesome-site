---
spec: awesome-site-v2
basePath: ./specs/awesome-site-v2
phase: design
task: 0/0
updated: 2026-02-06T14:52:00Z
---

# Progress: awesome-site-v2

## Original Goal

Complete ground-up rebuild of the Awesome Video Dashboard (awesome-list-site at /Users/nick/Desktop/awesome-list-site) into a modern Next.js application at /Users/nick/Desktop/awesome-site. Requirements:

- **Full feature parity** with legacy app (75+ API endpoints, 30+ features, 26 DB tables, admin panel)
- **All shadcn/ui components** (new-york style) for every UI element
- **Stitch MCP** for designing every screen (using GEMINI_3_PRO model)
- **Better Auth** for authentication (email/password + Google + GitHub OAuth)
- **Prisma ORM** with PostgreSQL (can reuse same DB or create new, redesign schema as needed)
- **Multi-theme support** - cyberpunk default + 3-4 additional user-switchable themes
- **Functional validation** at each phase with real screenshots via browser automation
- **Skills to activate**: design-md, stitch-loop, remotion, enhance-prompt, shadcn-ui, better-auth, and 20+ others
- **Validation protocol**: Test as end-user and admin, verify edits propagate, import/export works, etc.

Source: /Users/nick/Desktop/awesome-list-site
Target: /Users/nick/Desktop/awesome-site

## Completed Tasks

- Research phase: exhaustive legacy analysis, technology research, design system documentation
- Requirements phase: 46 user stories, 81 functional requirements, 25 non-functional requirements
- Design phase: full architecture with mermaid diagrams, 31-model Prisma schema plan, 72-step implementation roadmap, feature module definitions, middleware chain, TypeScript interfaces, error handling strategy, caching strategy, security considerations

## Current Task

Awaiting next task (1.3 Create Prisma client singleton and shared API utilities)

## Completed Tasks (Implementation)
- [x] 1.1 Write complete Prisma schema (31 models) - pending commit
- [x] 1.2 Push schema to Neon database - pushed 35 tables to local PostgreSQL (awesome_list_v2), generated Prisma client at src/generated/prisma

## Learnings

- Legacy schema has 26 tables with Drizzle ORM. Resources link to categories via TEXT name matching, not FK. Prisma redesign should add proper FK relations.
- Legacy uses TWO coexisting patterns: route registration functions (older) and Module interface (newer research module). New app should use consistent Next.js Route Handlers.
- Better Auth v1.4+ supports experimental.joins for optimized Prisma queries. Must use `@better-auth/cli generate` to create auth tables in Prisma schema.
- Prisma 7 requires explicit output path in schema.prisma (already configured at `../src/generated/prisma`).
- Legacy has 60+ API endpoints across 15 route files. Endpoint reimplementation is the largest work item.
- Legacy theme system stores 8 themes with full HSL/OKLCH CSS variable sets. New project uses OKLCH-only cyberpunk design. Port 4 legacy themes to OKLCH.
- AI enrichment uses batch job queue pattern with retry logic (max 3 retries). Research system has cost tracking (tokens, USD) per model.
- GitHub sync is bidirectional with awesome-lint validation. This is the highest-complexity feature to port.
- New project already has 42 shadcn/ui components installed (new-york style), Stitch MCP project (ID: 14908959412283318545), and basic Next.js 16 scaffold.
- Legacy admin panel has 8 sub-modules: stats, users, resources, edits, categories, export, database, enrichment. Plus research module (8 endpoints).
- `next-themes` already in new project dependencies for theme switching.
- No test infrastructure exists in new project. Quality commands limited to lint + build.
- SPECIFICATION.md references Drizzle ORM + Next.js 15, but user goal specifies Prisma 7 + Next.js 16. Requirements follow user goal. This divergence needs explicit acknowledgment.
- SPECIFICATION.md defines 28 tables (expanded from legacy 26) adding: view_history, step_completions, ai_response_cache, github_resource_mapping, api_rate_limits, api_usage_logs, resource_edit_fields. Prisma schema must include all.
- Admin panel expanded from legacy 8 tabs to 14 tabs: Overview, Resources, Categories, Subcategories, Sub-subcategories, Users, Edit Suggestions, Enrichment, GitHub Sync, API Keys, Analytics, Tags, Learning Journeys, Settings.
- Google OAuth listed in user goal but absent from SPECIFICATION.md details. Flagged as unresolved question.
- Email provider for Better Auth verification/reset flows undefined. Must be configured before auth can work end-to-end.
- Functional validation mandate: all acceptance criteria designed for browser-based verification with screenshots. Zero unit tests, zero mocks per project rules.
- Requirements total: 46 user stories across 16 areas, 81 functional requirements (FR-1 through FR-81), 25 non-functional requirements. 6 unresolved questions flagged.
- **Architecture**: Feature-module organization under `src/features/` with co-located service, schemas, types per domain. Route Handlers in `app/api/` call into feature services.
- **Schema redesign**: 31 Prisma models (up from legacy 26). Key fix: resource-to-category via proper FK (Int) instead of TEXT name matching. 5 new tables: view_history, step_completion, ai_response_cache, github_resource_mapping, api_rate_limit, api_usage_log, site_setting.
- **Middleware pattern**: `withAuth`, `withAdmin`, `withValidation(zodSchema)`, `withApiKey` composable wrappers. Each returns a RouteHandler. Compose via nesting: `withAuth(withValidation(schema, handler))`.
- **API key hashing**: SHA-256 (not bcrypt like legacy) for O(1) lookup via hash index. Store `keyPrefix` (first 8 chars) for display. Full key shown once on creation.
- **Theme mechanism**: `data-theme` attribute on `<html>` + CSS custom properties per theme. Inline `<head>` script reads localStorage before first paint (flash prevention). 4 themes all OKLCH.
- **Admin panel**: Single page at `/admin` with client-side tab routing. 14 lazy-loaded tab components. TanStack Table for all data grids with server-side pagination.
- **Job processing**: In-process async (no external queue like Redis/BullMQ). Acceptable for single-server deployment. One active enrichment job at a time.
- **Rate limiting**: In-memory sliding window Map. Three tiers: anonymous 30/min/IP, session 100/min/user, API key tier-based per hour.
- **Search**: Client-side only (Fuse.js + cmdk). Index built on first Cmd+K open, cached 10min via TanStack Query.
- **State management**: TanStack Query for server state + nuqs for URL state. No global client state store needed (YAGNI).
- **Implementation is 8 phases, 72 steps**: Foundation -> Core Data -> User Features -> Admin Panel -> Advanced Features -> AI Research -> SEO -> Functional Validation.
- **Highest risk**: GitHub sync bidirectional (import first, export second, conflict resolution last). Second risk: 60+ route handlers surface area (mitigated by shared middleware).
- **Prisma 7 datasource**: `url` property is NO LONGER supported in schema.prisma datasource block. Connection URL must be in `prisma.config.ts` only. Schema datasource block should only have `provider`.
- **Schema model count**: Task says "31 models" but actual count across all groups (Better Auth 4 + Content 6 + User 5 + Edit 2 + Journey 4 + AI 4 + Research 2 + GitHub 4 + API 3 + Config 1) = 35 models total. All are implemented.
- **Database connection**: `.env` has Prisma Accelerate proxy URL (`prisma+postgres://localhost:51...`) which requires proxy running. `.env.local` has direct `postgresql://localhost:5432/awesome_list_v2`. For Prisma CLI commands, use `--url "postgresql://nick@localhost:5432/awesome_list_v2"` to bypass proxy. Local PostgreSQL is running and accessible.
- **Broadened .gitignore**: Changed `/src/generated/prisma` to `/src/generated/` for future-proofing any additional generators.

### Task Planning Insights
- **98 total tasks** across 10 phases (Foundation, Core Data, User Features, Admin Panel, Advanced Features, AI Research, SEO/Polish, Functional Validation, Quality Gates, PR Lifecycle)
- **Quality checkpoints every 2-3 tasks** throughout all phases -- 14 [VERIFY] checkpoints total
- **Phase 1 is the critical path**: Prisma schema (31 models), Better Auth config, theme system, layout, middleware chain must all work before anything else
- **Task sizing**: Each task targets ~200 lines max, grouped by feature module (service + API route + UI component together where possible)
- **Missing dependencies**: `@tanstack/react-table` is NOT in package.json despite being mentioned in design. Must `npm install` it. Also need `nuqs` for URL state.
- **Env vars needed**: Only `DATABASE_URL` exists. Must add: `BETTER_AUTH_SECRET`, `BETTER_AUTH_URL`, `GITHUB_CLIENT_ID`, `GITHUB_CLIENT_SECRET`, `GOOGLE_CLIENT_ID`, `GOOGLE_CLIENT_SECRET`, `ANTHROPIC_API_KEY`
- **Existing globals.css**: Default shadcn light/dark theme. Must be fully replaced with 4-theme OKLCH system in task 1.7
- **Existing layout.tsx**: Default Geist fonts. Must be replaced with JetBrains Mono + Inter in task 1.8
- **Admin approach**: Single `/admin` page with client-side tab routing via state/hash, not file-system routes. All 14 tabs lazy-loaded.
- **Validation is cURL-based**: No browser automation configured. All Phase 8 validation uses cURL + JSON parsing. Build verification via `npm run build`.
- **GitHub sync risk mitigation**: Import (task 5.5) before export (task 5.6) before admin UI (task 5.7). Incremental complexity.
- **No `@tanstack/react-virtual` in deps**: Needed for admin tables with 1000+ rows. Add in task 4.2 if DataTable needs virtual scrolling.

## Blockers

- None currently

## Interview Responses

### Requirements Interview (from requirements.md)
- Primary users: End users via UI (regular users browsing resources, bookmarking, submitting + admins managing content)
- Priority tradeoffs: Feature completeness (every legacy feature must work before shipping - full parity is non-negotiable)
- Success criteria: All of the above (full parity, better UX, and solid performance)

### Design Interview (from design.md)
- Architecture style: Feature-based modules (organize by domain: resources/, auth/, admin/, ai/ with co-located routes, services, types)
- Technology constraints: No constraints (architect free to choose patterns within decided stack)
- Integration approach: Fresh database (awesome_list_v2), migrate data later after core features work
- API pattern: Shared middleware chain (withAuth, withAdmin, withValidation wrappers, consistent error responses)
- Admin panel: Client-side SPA under /admin (lazy-loaded tabs, TanStack Table for data grids, minimal SSR)

### Tasks Interview (from tasks.md)
- Testing depth: Functional validation only (NO mocks, NO unit tests â€” real UI, real server, cURL, screenshots)
- Deployment approach: Standard Vercel deploy with Neon PostgreSQL
- Execution priority: Quality first (thorough from the start, slower but more polished)

## Next

Tasks phase complete (98 tasks across 10 phases). Awaiting approval to proceed to execution.
