---
spec: admin-complete
basePath: specs/admin-complete
phase: requirements
task: 0/0
updated: 2026-02-07T16:30:00Z
---

# Progress: admin-complete

## Original Goal

Achieve 100% feature parity with legacy admin: redesign sidebar with shadcn Sidebar, implement all 6 missing tabs, fix audit findings.

## Completed Tasks

- Research phase completed (2026-02-07)
- Requirements phase completed (2026-02-07)
- [x] 1.1 Add Toaster to root layout and replace inline messages in export-tab
- [x] 1.2 Replace inline messages with toasts in 5 tabs
- [x] 1.3 Quality checkpoint: lint + typecheck - PASS
- [x] 1.4 Create research types and helpers
- [x] 1.5 Create CostDashboard component
- [x] 1.6 Create JobCreationDialog component
- [x] 1.7 Create FindingsList component

## Current Task

Awaiting next task

## Learnings

- V3 audit (`web-v3-audit`) already built ALL 6 "missing" admin tabs and upgraded the sidebar to shadcn Sidebar with collapsible groups. The tabs are NOT missing - they exist and are registered.
- Admin sidebar already uses shadcn SidebarProvider + Sidebar (collapsible="icon") + SidebarInset + Collapsible groups. No structural redesign needed.
- Database seed endpoint at `/api/admin/database/seed/route.ts` is a STUB - it only counts rows, does not actually seed data. This needs a real implementation.
- Research tab is the biggest gap: legacy has 13 files (CostDashboard, FindingCard, FindingsList, ResearchJobsTable, NewResearchJobDialog, ResearchJobDetail, ReportViewer, JobMonitor, hooks, types, index) vs V2's single 439-line file. Missing: cost charts, finding apply/dismiss, job creation dialog, agent logs, report viewer, real-time monitoring.
- Link Health tab missing recharts trend chart and job history vs legacy. Legacy uses async job model with history; V2 uses simple POST/GET.
- All 6 tabs use inline text for success/error messages instead of toast notifications. Sonner is installed at `src/components/ui/sonner.tsx` but unused in admin tabs.
- Export tab actually EXCEEDS legacy with multi-format support (JSON/CSV/Markdown vs legacy's Markdown-only).
- Validation and Audit tabs are at or near full parity with legacy.
- Legacy research uses recharts for cost visualization (bar chart by model, daily trend). V2 has chart.tsx (recharts wrapper) but doesn't use it in research/link-health tabs.
- Quality commands: `npx eslint` (lint), `npx tsc --noEmit` (typecheck), `npm run build` (build). No test runners.
- Spec scope should be reframed: "complete feature parity within existing tabs" not "implement missing tabs."
- Backend service `research-service.ts` already has 6 unused functions (getCostBreakdown, applyFinding, dismissFinding, getJob, cancelJob, getJobReport) -- only need API routes and UI wiring, not new business logic.
- Prisma schema has `AiUsageDaily` table with date/model/requestCount/totalTokens/estimatedCostUsd -- cost dashboard data source already exists.
- `ResearchFinding` model has `applied` and `dismissed` boolean fields -- apply/dismiss backend is fully implemented.
- `<Toaster />` component is NOT rendered in root layout (`src/app/layout.tsx`) -- must be added before any toast works. Only 2 files currently import `toast` from sonner (resources-tab.tsx, suggest-edit page).
- Research tab needs 7 new API routes to expose existing service functions. No new DB tables needed for research features.
- Link health job history may need a new DB table or a run-tracking column -- this is an open question for design phase.
- Database seed stub at `/api/admin/database/seed/route.ts` is 24 lines that only count rows. Real implementation needs awesome-list parser or fixture importer.

## Interview Responses

### Requirements Interview (from requirements.md)
- Primary users: Both developers and admins
- Priority tradeoffs: Feature completeness - ensure all legacy features are present
- Success criteria: Full functional validation through real browser testing (Puppeteer/agent browser against localhost), act as end user, validate every feature, improve and exceed legacy where possible

### Design Interview (from design.md)
- Architecture style: Extend existing architecture - build on current tab patterns, add components alongside existing files
- Technology constraints: No constraints - use whatever libraries/patterns make sense (recharts, sonner already installed)
- Integration approach: Use existing APIs - wire new UI to existing service functions via new API routes

### Tasks Interview (from tasks.md)
- Testing depth: Functional validation + Playwright E2E test suite for admin flows
- Deployment approach: Standard CI/CD pipeline
- Execution priority: Quality first - thorough from the start, no shortcuts

## Blockers

- None currently

## Next

Task 1.2: Replace inline messages with toasts in database, validation, settings, link-health, github-sync tabs

## Design Phase Learnings

- All 7 API routes listed as "needed" in requirements ALREADY EXIST -- research costs, job CRUD, findings apply/dismiss, report. Zero API layer work needed for research features.
- `ResourceAuditLog.performedById` is a plain String, NOT a Prisma @relation to User. User resolution requires batch lookup in the API handler, not a schema change.
- Link health results stored in Settings table as single JSON blob via `setSetting("linkHealth.lastResults", ...)`. No `LinkCheckResult` DB model exists. History requires appending to a new `linkHealth.history` settings key.
- `getCostBreakdown()` returns `dailyUsage` array with per-day per-model entries. Recharts BarChart needs pivot transform: group by date, spread models into columns.
- Toast migration is mechanical: 9 inline `<p>` elements across 6 tabs need replacing with `toast.success()`/`toast.error()` in `useMutation` callbacks. Pattern already established in `resources-tab.tsx`.
- Database seed stub is 24 lines that only counts rows. Real implementation should reuse `processAwesomeListMarkdown()` from github-import feature to stay DRY.
- ConfirmDialog component has no `children` prop for custom content (like a checkbox). May need to extend or use a separate Dialog for seed with `clearExisting` option.
- Research tab decomposition: 439 lines -> 8 files. The `admin/page.tsx` lazy import needs path update from `research-tab` to `research/index`.
- Sidebar has 6 groups; Moderation group has only 1 item (Edit Suggestions). Moving it to Content Management reduces to 5 groups -- simple array edit in `NAV_GROUPS`.

## Task Planning Learnings

- Task dependency chain: Toast infrastructure (1.1-1.2) MUST come first since all later features use `toast()` calls. Research types (1.4) must precede all 6 research component files. Stats service expansion (1.13) before database-tab UI (1.15). Link health service history (1.17) before trend chart UI (1.18-1.19).
- The github import function is `parseAwesomeListMarkdown` in `src/features/github/markdown-parser.ts` (NOT `processAwesomeListMarkdown` as mentioned in design). Seed route should import from this path.
- `ConfirmDialog` has no `children` prop -- seed clearExisting checkbox needs either extending ConfirmDialog or using a separate Dialog. Task 1.15 should handle this flexibility.
- Only `resources-tab.tsx` currently imports `toast` from `"sonner"` in admin tabs. All other 6 tabs need the import added.
- `Toaster` component in `sonner.tsx` uses `useTheme()` from `next-themes` -- it must be rendered inside `ThemeProvider` in layout.tsx (after it, not before).
- Research tab lazy import in `admin/page.tsx` uses `.then((m) => ({ default: m.ResearchTab }))` -- the new `research/index.tsx` must export `ResearchTab` as a named export to maintain this pattern.
- No Playwright setup exists yet -- Phase 3 tasks need to handle initial Playwright installation and config.
- Quality gates confirmed: `npx eslint`, `npx tsc --noEmit`, `npm run build`. No test runner exists beyond E2E.
- 33 tasks total across 5 phases, with [VERIFY] checkpoints after every 2-3 implementation tasks.
- No `Reality Check (BEFORE)` section found -- this is a feature spec, not a fix spec. No VF task needed.

### Verification: 1.3 [VERIFY] Quality checkpoint: lint + typecheck
- Status: PASS
- Commands: npx eslint (exit 0), npx tsc --noEmit (exit 0)
- No fixes needed, zero lint errors, zero type errors
