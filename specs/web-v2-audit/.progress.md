---
spec: web-v2-audit
basePath: specs/web-v2-audit
phase: tasks
task: 1/38
updated: 2026-02-06T23:00:00-05:00
---

# Progress: web-v2-audit

## Original Goal

Comprehensive audit of the awesome-site v2 rebuild covering three dimensions:

1. **Full feature parity audit** — Compare v2 rebuild against the legacy app at `/Users/nick/Desktop/awesome-list-site`. Verify all 75+ endpoints, 14 admin tabs, and 2600+ resources are implemented and functional.

2. **Alpha quality gate** — Validate current alpha build quality. Check for bugs, missing features, broken flows, and generate a prioritized fix list.

3. **Pre-launch readiness** — End-to-end validation for production readiness including performance, security, UX, and data integrity.

## Completed Tasks

- Research phase: comprehensive audit of both codebases
- [x] 1.1 Create global error boundary - PENDING_COMMIT

## Current Task

Awaiting next task

## Learnings

- Legacy app has 83 unique API endpoints (not 75+ as stated) across 12 route files + monolithic routes.ts (108KB)
- Legacy admin dashboard has 16 tabs (not 14 as stated): approvals, edits, enrichment, export, database, validation, resources, categories, subcategories, sub-subcategories, users, github, link health, audit, research
- V2 rebuild achieves ~90% feature parity with 111 method-route combinations across 76 route files
- V2 has 14 admin tabs with 5 NEW tabs not in legacy: API Keys, Analytics, Tags, Learning Journeys, Settings
- V2 schema is more comprehensive: 35 Prisma models vs legacy's ~21 Drizzle tables (adds ApiRateLimit, ApiUsageLog, SiteSetting, ViewHistory, StepCompletion, AiResponseCache, GithubResourceMapping)
- V2 compiles with zero TypeScript errors and zero ESLint errors (34 warnings only)
- V2 auth middleware pattern (withAuth/withAdmin/withApiKey/withValidation) is significantly cleaner than legacy's ad-hoc middleware
- V2 uses Next.js 16 + React 19 (very modern stack)
- CRITICAL: V2 missing error.tsx, loading.tsx, not-found.tsx boundary files (Next.js convention)
- CRITICAL: V2 has no database seed mechanism
- V2 has proper SEO: sitemap.ts, robots.ts, opengraph-image.tsx, generateMetadata on all public pages, JSON-LD
- Missing legacy endpoints are mostly LOW priority (awesome-list data, switch-list, learning-path generation) - architectural choices rather than gaps
- Key functional gap: no `/api/resources/[id]/related` endpoint despite recommendation engine existing
- Requirements organized into 6 work streams (WS-1 through WS-6) for parallel implementation
- 35 functional requirements + 10 non-functional requirements identified
- Total effort estimate: ~18-26h across all priorities
- Critical path: error boundaries (WS-1) + seed script (WS-4) must ship before anything else
- ESLint fixes (WS-5) is a quick ~1-2h win that can run in parallel with critical work
- 6 unresolved questions flagged for user decision (seed data source, ISR interval, related resources fallback, legacy endpoint deprecation, advanced search scope, learning path deferral)
- User success criteria requires ALL THREE: critical/high resolved + full parity + production-ready quality bar
- Zero `console.log` statements in codebase (already clean)
- Zero existing error.tsx, loading.tsx, or not-found.tsx files -- all must be created from scratch
- Zero existing Cache-Control headers or ISR revalidate exports -- all must be added
- `generateMetadata` missing from 7 pages: favorites, bookmarks, history, profile, submit, suggest-edit, journeys/[id]
- Resource detail page already has inline related resources query (same-category, 6 items) at lines 67-82 -- can be replaced with dedicated service
- `recommendation-engine.ts` is fully functional with weighted scoring (category 30%, tag 25%, co-viewed 20%, learning goals 15%, recency 10%) and popular fallback
- Existing `UserInteraction` model with `type: "rate"` and `metadata` JSON field is suitable for recommendation feedback storage (no schema changes needed)
- Prisma seed convention requires `prisma.seed` key in package.json pointing to tsx runner
- All unique constraints (slug, URL, userId+resourceId) support idempotent upsert for seed script
- `withValidation` middleware exists but most routes do inline Zod validation -- either pattern is acceptable
- Next.js 16 params are async Promises (must `await ctx.params`) -- all existing routes follow this correctly
- Search dialog uses Fuse.js for client-side fuzzy search; advanced search page should use server-side API filters for URL-driven state
- **Task planning**: `journeys/[id]/layout.tsx` ALREADY EXISTS with metadata -- design.md incorrectly listed it as missing. Only 6 pages need metadata (not 7)
- **Task planning**: `submit/page.tsx` is NOT `"use client"` -- can export metadata directly without layout file
- **Task planning**: favorites, bookmarks, history, profile pages ARE `"use client"` -- need layout.tsx files for metadata
- **Task planning**: suggest-edit page IS `"use client"` -- needs layout.tsx for metadata
- **Task planning**: ESLint underscore-prefix params (`_ctx`, `_req`) still warn -- ESLint config likely needs `argsIgnorePattern: "^_"` in `@typescript-eslint/no-unused-vars` rule
- **Task planning**: `data-table.tsx` has `react-hooks/incompatible-library` warning from TanStack Table's `useReactTable()` -- known React Compiler issue, needs eslint-disable comment
- **Task planning**: Resources browse page (`/resources`) is `"use client"` so ISR `revalidate` export is inapplicable there; ISR applies to 5 server-rendered pages only
- **Task planning**: No `prisma.config.ts` exists; Prisma 7 uses `package.json` `prisma.seed` key
- **Task planning**: 38 total tasks across 7 phases: Foundation (8) -> Code Quality (2) -> Features (4+cache+ISR) -> Production (8) -> Pages+Stubs (4) -> Validation (3) -> PR Lifecycle (2)

## Blockers

- None currently

## Interview Responses

### Requirements Interview (from requirements.md)
- Primary users: Both developers and end users
- Priority tradeoffs: Feature completeness
- Success criteria: All critical/high items resolved + Full feature parity with legacy + Production-ready quality bar

### Design Interview (from design.md)
- Architecture style: Extend existing architecture
- Technology constraints: No constraints
- Integration approach: Use existing APIs and interfaces

### Tasks Interview (from tasks.md)
- Testing depth: Minimal - functional validation only (no mocks/tests per project mandate)
- Execution priority: Quality first - thorough from start

## Next

Task 1.2: Create public route error boundary
